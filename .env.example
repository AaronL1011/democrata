# DemÃ³crata Environment Configuration
# Copy this file to .env and fill in values

# =============================================================================
# Embedding Provider Configuration
# =============================================================================
# Supported providers: openai, ollama
EMBEDDING_PROVIDER=openai

# =============================================================================
# OpenAI Configuration (when EMBEDDING_PROVIDER=openai)
# =============================================================================
# Required when using OpenAI provider (also used by agent models)
OPENAI_API_KEY=sk-your-openai-api-key

# Optional: Custom base URL for OpenAI-compatible APIs (e.g., OpenRouter, Azure)
# OPENAI_BASE_URL=https://openrouter.ai/api/v1

# Embedding model selection (defaults shown)
# EMBEDDING_MODEL=text-embedding-3-small
# EMBEDDING_DIMENSIONS=1536

# =============================================================================
# Ollama Configuration (when EMBEDDING_PROVIDER=ollama)
# =============================================================================
# OLLAMA_BASE_URL=http://localhost:11434
# EMBEDDING_MODEL=nomic-embed-text
# EMBEDDING_DIMENSIONS=768

# =============================================================================
# Agent Pipeline Configuration
# =============================================================================
# The RAG pipeline uses specialized agents for improved accuracy and reduced
# hallucinations. Each agent can use a different model for cost optimization.

# Query Planner: Classifies intent and extracts entities (fast model recommended)
AGENT_PLANNER_MODEL=gpt-4o-mini

# Data Extractor: Extracts grounded facts from context (capable model recommended)
AGENT_EXTRACTOR_MODEL=gpt-4o

# Response Composer: Formats extracted data into components (capable model recommended)
AGENT_COMPOSER_MODEL=gpt-4o

# Response Verifier: Validates claims against context (fast model recommended)
AGENT_VERIFIER_MODEL=gpt-4o-mini

# Enable/disable the verification step (adds latency but improves accuracy)
AGENT_VERIFIER_ENABLED=true

# Retrieval configuration
AGENT_DEFAULT_TOP_K=10
AGENT_MIN_CHUNKS=3

# =============================================================================
# Redis (cache)
# =============================================================================
REDIS_URL=redis://localhost:6379/0

# Anonymous session store: memory (default) or redis (production)
ANONYMOUS_SESSION_STORE=memory

# =============================================================================
# Vector Store (Qdrant)
# =============================================================================
QDRANT_URL=http://localhost:6333
QDRANT_COLLECTION=democrata_chunks

# =============================================================================
# Blob Storage
# =============================================================================
# Provider: local (default) or s3
BLOB_STORAGE_PROVIDER=local
BLOB_STORAGE_PATH=./data/blobs

# S3 configuration (when BLOB_STORAGE_PROVIDER=s3)
# S3_BUCKET=democrata-blobs
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY optional (use IAM/default chain)

# =============================================================================
# Caddy Reverse Proxy (optional)
# =============================================================================
# When using the caddy service in docker-compose, set domains for API and frontend.
# Local: API_DOMAIN=api.localhost, APP_DOMAIN=app.localhost
# Production: API_DOMAIN=api.example.com, APP_DOMAIN=app.example.com
# With Caddy, also set VITE_API_URL and CORS_ORIGINS to match (e.g. https://api.example.com)
# API_DOMAIN=api.localhost
# APP_DOMAIN=app.localhost

# =============================================================================
# CORS Configuration
# =============================================================================
# Comma-separated list of allowed origins for CORS
# With Caddy: include https://app.example.com (or your APP_DOMAIN)
CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173

# =============================================================================
# Cost Configuration
# =============================================================================
# Margin applied to API costs for pricing display (0.4 = 40%)
COST_MARGIN=0.4

# =============================================================================
# Rate Limiting
# =============================================================================
# Maximum requests per minute per session
RATE_LIMIT_PER_MINUTE=30

# =============================================================================
# API Authentication
# =============================================================================
# Uploads require either a signed-in session (JWT) or a valid API key.
# Comma-separated list of API keys for programmatic access (e.g., ingestion)
# API_KEYS=key1,key2,key3

# =============================================================================
# Frontend Configuration
# =============================================================================
# API server URL for the frontend (Vite environment variable)
# With Caddy: use https://api.example.com (match API_DOMAIN). Local: http://localhost:8000
VITE_API_URL=http://localhost:8000

# =============================================================================
# Supabase (Database + Auth)
# =============================================================================
# Supabase provides both Postgres and auth. Use it as the database when deployed.
# Dashboard: https://supabase.com/dashboard/project/_/settings

# Database: Settings > Database > Connection string
# Local dev (docker-compose): use local Postgres below
# Deployed: use URI from Connection pooling (Transaction mode, port 6543)
DATABASE_URL=postgresql://democrata:democrata_dev@localhost:5432/democrata

# Auth: Settings > API
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key

# Optional: JWT verification (Settings > API > JWT Settings)
# SUPABASE_JWT_SECRET=your-jwt-secret

# =============================================================================
# Stripe Payments
# =============================================================================
# Get these from your Stripe dashboard (Developers > API keys)
# Use test keys for development (sk_test_..., whsec_...)
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# Optional: Pre-configured price IDs for credit packs
# STRIPE_PRICE_500=price_...
# STRIPE_PRICE_1000=price_...
# STRIPE_PRICE_2000=price_...
